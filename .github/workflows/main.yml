name: Daily Linux Tip Scheduler

on:
  schedule:
    # Her g羹n sabah 09:00'da (UTC+3 i癟in 06:00 UTC)
    - cron: '0 8 * * *'
  workflow_dispatch: # Manuel tetikleme butonu i癟in buras覺 art

permissions:
  contents: write # Repoya yazma izni (Commit i癟in art)

jobs:
  broadcast-tip:
    runs-on: ubuntu-latest

    steps:
      - name: Repoyu ek (Checkout)
        uses: actions/checkout@v4

      - name: Python Kurulumu
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Ba覺ml覺l覺klar覺 Y羹kle
        run: |
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          if [ ! -f requirements.txt ]; then pip install requests; fi

      - name: Scripti al覺t覺r
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          if [ -f src/main.py ]; then python src/main.py; else echo "HATA: src/main.py bulunamad覺!"; exit 1; fi

      - name: Durumu Kaydet (Git Commit & Push)
        run: |
          git config --global user.name 'LinuxTipBot'
          git config --global user.email 'bot@noreply.github.com'
          
          # 1. nce yerel deiiklii commit et (Hen羹z g繹nderme)
          git add data/tips.json
          git commit -m " Bot: G羹nl羹k ipucu yay覺nland覺 [skip ci]" || echo "Commit edilecek deiiklik yok."
          
          # 2. Uzaktaki deiiklikleri 癟ek ve bizimkilerin alt覺na ekle (Rebase)
          git pull --rebase origin main
          
          # 3. imdi g繹nder
          git push origin main
